{% extends 'index.html' %}
{% load crispy_forms_tags %}

{% block content %}

<h4>Rozgrywki: {{ cup.name }}</h4>
<h5>Rodzaj: {% if cup.type == "Puchar" %}Puchar
            {% elif cup.type == "1 mecz" %}Liga (1 mecz)
            {% elif cup.type == "2 mecze" %}Liga (2 mecze)
            {% endif %}</h5>
{% if cup.type == 'Puchar' %}
    <h5>Aktualny etap:
                        {% if cup.actual_round == None %}
                            Nie rozpoczęte
                       {% else %}
                            {% if cup.finished %}
                                Zakończony
                            {% else %}
                                {{ cup.actual_round }}
                            {% endif %}
                          {% endif %}

    </h5>
{% endif %}
<hr>
<br>
{% if cup.registration == 'Zamknięta' %}
    {% if rounds|length == 0 %}
        <p class="btn btn-info"> Rejetracja zamknięta</p>
    {% endif %}
{% else %}
        {% if cup.number_of_players < 4 %}
            <p class="btn btn-info"> Rejetracja otwarta</p>            <br>
            <p class="btn btn-warning">Żeby rozpocząć turniej trzeba wprowadzić minimum 4 graczy.</p>
            <br>
            <p class="btn btn-info">Liczba graczy w systemie: {{ cup.number_of_players }}</p>
            <p><a href="{% url 'edit_players' cup.id %}" class="btn btn-primary">Wprowadź</a></p>
        {% else %}
            <p><a href="{% url 'close_registration' cup.id %}" class="btn btn-secondary">Zamknij rejestrację</a></p>
            <p class="btn btn-info">Liczba graczy w systemie: {{ cup.number_of_players }}</p>

        {% endif %}
{% endif %}
{% if cup.registration == 'Zamknięta' and not match_not_played %}
    {% if not cup.actual_round.name == "Finał" and cup.type == 'Puchar' %}
        <p><a href="{% url 'generate_round' cup.id %}" class="btn btn-secondary">Generuj etap</a></p>
    {% endif %}
    {% if cup.type == '1 mecz'  or cup.type == '2 mecze' %}
        <p><a href="{% url 'generate_round' cup.id %}" class="btn btn-secondary">Generuj rozgrywki</a></p>
    {% endif %}
{% else %}
    {% if match_not_played %}
        <p class="btn btn-info">Gramy!</p>
    {% endif %}
{% endif %}

<br>
{% if cup.league_generated and cup.type == "1 mecz" or cup.type == "2 mecze" %}
<h4>Tabela ligowa</h4>
        <table class="table table-striped table-dark">
        <thead>
        <tr>
          <th width="5%" scope="col">Miejsce</th>
          <th scope="col">Gracz</th>
            {% if cup.choosing_teams == True %}
          <th scope="col">Drużyna</th>
            {% endif %}
          <th width="5%" scope="col">Z</th>
          <th width="5%" scope="col">R</th>
          <th width="5%" scope="col">P</th>
          <th width="5%" scope="col">BZ</th>
          <th width="5%" scope="col">BS</th>
          <th width="5%" scope="col">BB</th>
          <th width="5%" scope="col">PKT</th>
        </tr>
        </thead>
        <tbody>
    {% for player in players %}
        <tr>
            <th scope="row"><span class="btn btn-secondary">{{ forloop.counter }}</span></th>
          <td><span class="btn btn-secondary">{{ player.name }}</span></td>
            {% if cup.choosing_teams == True %}
                <th scope="row"><span class="btn btn-secondary">{{ player.team }}</span></th>
            {% endif %}
            <th scope="row"><span class="btn btn-secondary">{{ player.wins }}</span></th>
            <th scope="row"><span class="btn btn-secondary">{{ player.draws }}</span></th>
            <th scope="row"><span class="btn btn-secondary">{{ player.losses }}</span></th>
            <th scope="row"><span class="btn btn-secondary">{{ player.goals_scored }}</span></th>
            <th scope="row"><span class="btn btn-secondary">{{ player.goals_losted }}</span></th>
            <th scope="row"><span class="btn btn-secondary">{{ player.goals_bilans }}</span></th>
            <th scope="row"><span class="btn btn-secondary">{{ player.points }}</span></th>
               </tr>
            {% endfor %}
        </tbody>
        </table>
<br>
{% endif %}
{% for round in rounds %}
<h4>{{ round.name }}</h4>
<hr>
<br>
{% if round.pausing %}
<p>Pauzuje: {{ round.pausing.name }}</p>
<br>
{% endif %}
<table class="table table-striped table-dark">
        <thead>
        <tr>
          <th scope="col"></th>
          <th scope="col">Gospodarz</th>
          <th scope="col">Rezultat</th>
          <th scope="col">Gość</th>
          <th scope="col" colspan="2">Akcja</th>
        </tr>
        </thead>
        <tbody>
    {% for match in matches %}
        {% if match.round.name == round.name %}
        <tr>
            <th scope="row" width="22.5%"><span></span></th>
            <td width="20%"><span class="btn btn-secondary">{{ match.player1 }}</span></td>
          <td width="15%"><span class="btn btn-secondary">{% if match.result1 != None and match.result2 != None %}{{ match.result1 }} : {{ match.result2 }}{% else %} Nie rozegrano {% endif %}</span></td>
          <td width="20%"><span class="btn btn-secondary">{{ match.player2 }}</span></td>
          <td width="45%">
                    {% if match.finished == False %}
                           <a class="btn btn-secondary" href="{% url 'enter_the_result' cup.id match.id %}">Wprowadź</a>
                    {% else %}
                        {% if cup.type == "Puchar" %}
                            {% if cup.actual_round.id == round.id %}
                                {% if cup.len_rounds != rounds|length and cup.actual_round.name != 'Finał' %}
                                    <a class="btn btn-secondary" href="{% url 'delete_the_result' cup.id match.id %}">Wyczyść</a>
                                {% endif %}
                            {% endif %}
                        {% elif cup.type == "1 mecz" %}
                                    <a class="btn btn-secondary" href="{% url 'delete_the_result' cup.id match.id %}">Wyczyść</a>
                        {% endif %}
                    {% endif %}
          </td>
        </tr>
        {% endif %}
    {% endfor %}
        </tbody>
        </table>
{% endfor %}
{% endblock %}